---
import type { CollectionEntry } from "astro:content";
import BaseLayout from "./Base.astro";

interface Props {
	post: CollectionEntry<"post">;
}

const { post } = Astro.props;
const {
	// 关键点：从 post.data 中解构出 originalUrl
	data: { title, description, publishDate, originalUrl },
} = post;

const articleDate = publishDate.toISOString();
---

<BaseLayout meta={{ title, description, articleDate }}>
	<div class="mb-16 sm:mt-8">
		{/* 1. Back 按钮 */}
		<div class="mb-8">
			<button
				onclick="history.back()"
				class="group flex items-center gap-1 font-serif text-sm text-gray-500 transition-colors hover:text-black dark:hover:text-white"
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="16"
					height="16"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					class="transition-transform group-hover:-translate-x-1"
				>
					<polyline points="15 18 9 12 15 6"></polyline>
				</svg>
				Back
			</button>
		</div>

		{/* 2. 文章头部区域 */}
		<article class="flex flex-col gap-4">
			{/* 标题：强制使用 font-serif */}
			<h1
				class="font-serif text-3xl leading-tight font-bold text-black sm:text-4xl dark:text-white"
			>
				{title}
			</h1>

			{/* 摘要 */}
			{
				description && (
					<p class="font-serif text-lg leading-relaxed text-gray-500 dark:text-gray-400">
						{description}
					</p>
				)
			}

			{/* Meta 信息：日期 & 原文链接 */}
			<div class="mt-2 flex items-center gap-3 font-mono text-sm text-gray-400">
				<time datetime={articleDate}>
					{
						publishDate
							.toLocaleDateString("zh-CN", {
								year: "numeric",
								month: "2-digit",
								day: "2-digit",
							})
							.replace(/\//g, ".")
					}
				</time>

				{/* 只有当 originalUrl 存在时才渲染 */}
				{
					originalUrl && (
						<>
							<span>·</span>
							<a
								href={originalUrl}
								target="_blank"
								rel="noopener noreferrer"
								class="inline-flex items-center gap-1 underline decoration-dotted underline-offset-4 transition-colors hover:text-black dark:hover:text-white"
							>
								原文链接
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="14"
									height="14"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
									stroke-linecap="round"
									stroke-linejoin="round"
								>
									<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
									<polyline points="15 3 21 3 21 9" />
									<line x1="10" y1="14" x2="21" y2="3" />
								</svg>
							</a>
						</>
					)
				}
			</div>

			{/* 分割线 */}
			<hr class="my-8 border-dashed border-gray-200 dark:border-gray-700" />

			{/* 3. 正文区域：加上 prose-serif */}
			<div class="prose prose-lg prose-serif dark:prose-invert max-w-none font-serif">
				<slot />
			</div>
		</article>
	</div>
</BaseLayout>
