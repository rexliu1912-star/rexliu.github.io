---
import type { CollectionEntry } from "astro:content";
import BaseLayout from "./Base.astro";

interface Props {
	post: CollectionEntry<"post">;
}

const { post } = Astro.props;
const {
	data: { title, description, publishDate, originalUrl, tags },
} = post;

const articleDate = publishDate.toISOString();

// 自定义日期格式化逻辑：生成类似 "Mar 3rd 2025" 的格式
const formatCustomDate = (date: Date) => {
	const day = date.getDate();
	const month = date.toLocaleDateString("en-US", { month: "short" });
	const year = date.getFullYear();

	// 计算序数词后缀 (st, nd, rd, th)
	const getOrdinal = (n: number) => {
		const s = ["th", "st", "nd", "rd"];
		const v = n % 100;
		return s[(v - 20) % 10] || s[v] || s[0];
	};

	return `${month} ${day}${getOrdinal(day)} ${year}`;
};

const displayDate = formatCustomDate(publishDate);
---

<BaseLayout meta={{ title, description, articleDate }}>
	<div class="mb-16 sm:mt-8">
		{/* 1. Back 按钮 */}
		<div class="mb-8">
			<button
				onclick="history.back()"
				class="group flex items-center gap-1 font-serif text-sm text-gray-500 transition-colors hover:text-[#8953d1] dark:hover:text-[#a175e8]"
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="16"
					height="16"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					class="transition-transform group-hover:-translate-x-1"
				>
					<polyline points="15 18 9 12 15 6"></polyline>
				</svg>
				Back
			</button>
		</div>

		{/* 2. 文章头部区域 */}
		<article class="flex flex-col gap-4">
			<h1
				class="font-serif text-3xl leading-tight font-bold text-black sm:text-4xl dark:text-white"
			>
				{title}
			</h1>

			{
				description && (
					<p class="font-serif text-lg leading-relaxed text-gray-500 dark:text-gray-400">
						{description}
					</p>
				)
			}

			{/* Meta 信息：日期 & 原文链接 & Tags */}
			<div class="mt-2 flex flex-wrap items-center gap-3 font-serif text-sm text-gray-400">
				<time datetime={articleDate}>
					{displayDate}
				</time>

				{/* 只有当 originalUrl 存在时才渲染 */}
				{
					originalUrl && (
						<>
							<span>·</span>
							<a
								href={originalUrl}
								target="_blank"
								rel="noopener noreferrer"
								class="inline-flex items-center gap-1 font-serif underline decoration-dotted underline-offset-4 transition-colors hover:text-[#8953d1] dark:hover:text-[#a175e8]"
							>
								Original Link
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="14"
									height="14"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
									stroke-linecap="round"
									stroke-linejoin="round"
								>
									<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
									<polyline points="15 3 21 3 21 9" />
									<line x1="10" y1="14" x2="21" y2="3" />
								</svg>
							</a>
						</>
					)
				}

				{/* Tags */}
				{
					tags && tags.length > 0 && (
						<>
							<span>·</span>
							<div class="flex items-center gap-3">
								{tags.map((tag: string) => (
									<a
										href={`/tags/${tag}/`}
										class="capitalize transition-colors before:content-['#'] hover:text-[#8953d1] hover:underline hover:decoration-dotted hover:underline-offset-4 dark:hover:text-[#a175e8]"
									>
										{tag}
									</a>
								))}
							</div>
						</>
					)
				}
			</div>

			<hr class="my-8 border-dashed border-gray-200 dark:border-gray-700" />

			<div class="prose prose-lg prose-serif dark:prose-invert max-w-none font-serif">
				<slot />
			</div>
		</article>
	</div>
</BaseLayout>
