---
import type { CollectionEntry } from "astro:content";
import BaseLayout from "./Base.astro";

interface Props {
	post: CollectionEntry<"post">;
}

const { post } = Astro.props;
const {
	data: { title, description, publishDate, originalUrl, tags },
} = post;

const articleDate = publishDate.toISOString();
---

<BaseLayout meta={{ title, description, articleDate }}>
	<div class="mb-16 sm:mt-8">
		{/* 1. Back æŒ‰é’® */}
		<div class="mb-8">
			<button
				onclick="history.back()"
				class="group flex items-center gap-1 font-serif text-sm text-gray-500 transition-colors hover:text-black dark:hover:text-white"
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="16"
					height="16"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					class="transition-transform group-hover:-translate-x-1"
				>
					<polyline points="15 18 9 12 15 6"></polyline>
				</svg>
				Back
			</button>
		</div>

		{/* 2. æ–‡ç« å¤´éƒ¨åŒºåŸŸ */}
		<article class="flex flex-col gap-4">
			<h1
				class="font-serif text-3xl leading-tight font-bold text-black sm:text-4xl dark:text-white"
			>
				{title}
			</h1>

			{
				description && (
					<p class="font-serif text-lg leading-relaxed text-gray-500 dark:text-gray-400">
						{description}
					</p>
				)
			}

			{/* Meta ä¿¡æ¯ï¼šæ—¥æœŸ & åŸæ–‡é“¾æ¥ & Tags */}
			<div class="mt-2 flex flex-wrap items-center gap-3 font-mono text-sm text-gray-400">
				<time datetime={articleDate}>
					{
						publishDate
							.toLocaleDateString("zh-CN", {
								year: "numeric",
								month: "2-digit",
								day: "2-digit",
							})
							.replace(/\//g, ".")
					}
				</time>

				{/* åªæœ‰å½“ originalUrl å­˜åœ¨æ—¶æ‰æ¸²æŸ“ */}
				{
					originalUrl && (
						<>
							<span>Â·</span>
							<a
								href={originalUrl}
								target="_blank"
								rel="noopener noreferrer"
								class="inline-flex items-center gap-1 underline decoration-dotted underline-offset-4 transition-colors hover:text-black dark:hover:text-white"
							>
								Original Link
								<svg
									xmlns="http://www.w3.org/2000/svg"
									width="14"
									height="14"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
									stroke-linecap="round"
									stroke-linejoin="round"
								>
									<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
									<polyline points="15 3 21 3 21 9" />
									<line x1="10" y1="14" x2="21" y2="3" />
								</svg>
							</a>
						</>
					)
				}

				{/* ğŸ”´ æ ¸å¿ƒä¿®æ”¹ï¼šå°† span æ›¿æ¢ä¸º a æ ‡ç­¾ä»¥å®ç°è·³è½¬ */}
				{
					tags && tags.length > 0 && (
						<>
							<span>Â·</span>
							<div class="flex items-center gap-3">
								{tags.map((tag: string) => (
									<a
										href={`/tags/${tag}/`}
										class="capitalize transition-colors before:content-['#'] hover:text-black hover:underline hover:decoration-dotted hover:underline-offset-4 dark:hover:text-white"
									>
										{tag}
									</a>
								))}
							</div>
						</>
					)
				}
			</div>

			<hr class="my-8 border-dashed border-gray-200 dark:border-gray-700" />

			<div class="prose prose-lg prose-serif dark:prose-invert max-w-none font-serif">
				<slot />
			</div>
		</article>
	</div>
</BaseLayout>
