---
import { getCollection } from "astro:content";
import ActivityGraph from "@/components/ActivityGraph.astro";
import PageLayout from "@/layouts/Base.astro";

const allPosts = await getCollection("post");
const sortedPosts = allPosts.sort(
	(a, b) => new Date(b.data.publishDate).valueOf() - new Date(a.data.publishDate).valueOf(),
);

const MAX_POSTS = 10;
const MAX_PINNED = 5;

const pinnedPosts = sortedPosts.filter((p) => p.data.pinned === true).slice(0, MAX_PINNED);
const otherPosts = sortedPosts
	.filter((p) => !pinnedPosts.includes(p))
	.slice(0, MAX_POSTS - pinnedPosts.length);

const postsToDisplay = [...pinnedPosts, ...otherPosts];

const meta = {
	description: "Sovereign Individual - Crypto, AI and Life Insights",
	title: "Home",
};

function formatHomeDate(date: Date) {
	return date
		.toLocaleDateString("en-US", {
			month: "short",
			day: "numeric",
			year: "numeric",
		})
		.replace(",", "");
}
---

<PageLayout meta={meta}>
	<section class="mb-12">
		<h1 class="mb-4 font-serif text-4xl font-bold dark:text-white">Rex Liu</h1>
		<p class="max-w-2xl font-serif text-lg leading-relaxed text-gray-600 dark:text-gray-300">
			Writer and Builder in Crypto, AI, and Life.<br />
			在加密、人工智能和人生浪潮里，一边折腾一边记录的人。
		</p>
	</section>

	<ActivityGraph />

	<section aria-label="Blog post list">
		<h2
			class="mb-8 font-serif text-xs font-bold tracking-widest text-gray-400 uppercase dark:text-gray-500"
		>
			Essays
		</h2>

		<div class="space-y-12">
			{
				postsToDisplay.map((p) => (
					<article class="flex flex-col">
						<div class="mb-3 flex items-baseline justify-between">
							{/* 标题链接：设为 group/title 以便带动 [Pinned] 变色 */}
							<a
								href={`/posts/${p.id}/`}
								class="group/title font-serif text-xl font-medium text-black transition-colors hover:text-[#8953d1] hover:underline hover:decoration-[#8953d1] hover:decoration-2 hover:underline-offset-4 dark:text-white dark:hover:text-[#a175e8] dark:hover:decoration-[#a175e8]"
							>
								{p.data.pinned && (
									<span class="mr-2 text-base font-normal text-gray-400 transition-colors group-hover/title:text-[#8953d1] dark:text-gray-500 dark:group-hover/title:text-[#a175e8]">
										[Pinned]
									</span>
								)}
								{p.data.title}
							</a>
							<time
								datetime={p.data.publishDate.toISOString()}
								class="ml-4 shrink-0 font-serif text-sm text-gray-400/80"
							>
								{formatHomeDate(p.data.publishDate)}
							</time>
						</div>

						{p.data.description && (
							<p class="mb-2 line-clamp-2 max-w-3xl overflow-hidden font-serif text-base leading-relaxed text-gray-600 dark:text-gray-400">
								{p.data.description}
							</p>
						)}

						{/* More 链接：移除了 group-hover，仅在自身 hover 时变色 */}
						<a
							href={`/posts/${p.id}/`}
							class="w-fit font-serif text-xs font-medium text-gray-400 transition-colors hover:text-[#8953d1] dark:hover:text-[#a175e8]"
						>
							More
						</a>
					</article>
				))
			}
		</div>
	</section>
</PageLayout>
